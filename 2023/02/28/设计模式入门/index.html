<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cloudplayer99.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="学习资源： 设计模式 | 爱编程的大丙 Refactoring.Guru 设计模式">
<meta property="og:type" content="article">
<meta property="og:title" content="C++设计模式速成笔记">
<meta property="og:url" content="https://cloudplayer99.github.io/2023/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Cloud_Player&#39;s Notes">
<meta property="og:description" content="学习资源： 设计模式 | 爱编程的大丙 Refactoring.Guru 设计模式">
<meta property="article:published_time" content="2023-02-28T09:00:00.000Z">
<meta property="article:modified_time" content="2023-02-28T10:08:58.000Z">
<meta property="article:author" content="Cloud_Player">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://cloudplayer99.github.io/2023/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A5%E9%97%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>C++设计模式速成笔记 | Cloud_Player's Notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Cloud_Player's Notes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://cloudplayer99.github.io/2023/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Cloud_Player">
      <meta itemprop="description" content="Coding for fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cloud_Player's Notes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C++设计模式速成笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-02-28 17:00:00 / 修改时间：18:08:58" itemprop="dateCreated datePublished" datetime="2023-02-28T17:00:00+08:00">2023-02-28</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>学习资源：<br>
<a href="https://www.subingwen.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">设计模式 | 爱编程的大丙</a><br>
<a href="https://refactoringguru.cn/design-patterns/" target="_blank" rel="noopener">Refactoring.Guru 设计模式</a></p>
</blockquote>
<a id="more"></a>
<ul>
<li>C++设计模式速成笔记
<ul>
<li>预备知识</li>
<li>设计模式三原则</li>
<li>设计模式一览</li>
<li>创建型模式
<ul>
<li>工厂方法模式 Factory Method</li>
<li>抽象工厂模式 Abstract Factory</li>
<li>单例模式 Singleton</li>
<li>原型模式 Prototype</li>
</ul>
</li>
<li>结构型模式
<ul>
<li>享元模式 Flyweight</li>
</ul>
</li>
<li>行为模式
<ul>
<li>命令模式 Command</li>
<li>策略模式 Strategy</li>
<li>状态模式 State</li>
<li>观察者模式 Observer</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1>C++设计模式速成笔记</h1>
<h2 id="预备知识"><a class="header-anchor" href="#预备知识">¶</a>预备知识</h2>
<p>什么是设计模式：三大类 二十七种</p>
<p>创建型模式：这类模式提供创建对象的机制，能够提升已有代码的灵活性和可复用性<br>
结构型模式：这类模式介绍如何将对象和类组装成较大的结构， 并同时保持结构的灵活和高效<br>
行为模式：这类模式负责对象间的高效沟通和职责委派</p>
<p>面向对象语言：封装 继承 多态<br>
大象装冰箱 面对过程 面向对象 对象即类的实例<br>
封装：把一些属性（成员变量）与行为（成员函数）封装到一个类<br>
继承：子类继承父类（公共或受保护的成员变量和成员属性，即非私有的）<br>
多态：同名函数具有不同的状态：<br>
需要发生继承，父类定义虚函数，子类重写父类的虚函数，父类的指针或引用指向子类对象并通过其调用子类从父类继承来的虚函数（概念：纯虚函数，抽象类）</p>
<p>UML类图 unified modeling meeting<br>
通过UML把对应的类的结构描述出来<br>
把类与类之间的关系清晰的表述出来：继承、关联、聚合、组合、依赖</p>
<p>描述类结构</p>
<p>可见性：+ public # protected - private _ static（用加下划线的方式表示static）<br>
属性：【可见性】【属性名称】:【类型】=【缺省值，可选】<br>
- m_gunName:string = “AK-47”<br>
方法：【可见性】【方法名称】(【参数名:参数类型, …】):【返回值类型】<br>
- shoot():void<br>
注：抽象类，类名用斜体，虚函数跟随类名也使用斜体，纯虚函数最后给函数指定 =0</p>
<p>描述类关系</p>
<ul>
<li>继承（泛化Generalization）：带空心三角形的实线</li>
</ul>
<div align=center><img width = '400' height = '250' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Generalization.PNG"/></div>
<ul>
<li>关联Assocition（例如将一个类的对象作为另一个类的成员变量）：
<ul>
<li>单向关联：带单向箭头的实线</li>
<li>双向关联：带双向箭头的实线</li>
<li>自关联（当前类中包含一个自身类型的对象成员，例如链表）：箭头指向自己的实线</li>
<li>关联平等，聚合不平等</li>
</ul>
</li>
</ul>
<div align=center><img width = '536' height = '214' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Assocition.PNG"/></div>
<ul>
<li>聚合Aggregation（整体与部分，成员对象是整体的一部分，且可以脱离整体对象独立存在）
<ul>
<li>代码实现聚合关系，成员对象通常以构造方法、Setter 方法的方式注入到整体对象之中</li>
<li>带空心菱形的实线</li>
</ul>
</li>
</ul>
<div align=center><img width = '432' height = '255' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Aggregation.PNG"/></div>
<ul>
<li>组合Composition（整体与部分，整体对象控制成员对象的生命周期，同生共死）
<ul>
<li>代码实现组合关系，通常在整体类的构造方法中直接实例化成员类，整体对象析构其子对象一并析构</li>
<li>带实心菱形的实线</li>
</ul>
</li>
</ul>
<div align=center><img width = '416' height = '252' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Composition.PNG"/></div>
<ul>
<li>依赖Dependency（使用）：带箭头的虚线
<ul>
<li>将一个类的对象作为另一个类中方法的参数</li>
<li>在一个类的方法中将另一个类的对象作为其对象的局部变量</li>
<li>在一个类的方法中调用另一个类的静态方法</li>
</ul>
</li>
</ul>
<div align=center><img width = '442' height = '260' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Dependency.PNG"/></div>
<h2 id="设计模式三原则"><a class="header-anchor" href="#设计模式三原则">¶</a>设计模式三原则</h2>
<ul>
<li>单一职责原则
<ul>
<li>对一个类而言，应该仅有一个引起它变化的原因，其实就是将这个类所承担的职责单一化（解耦合）</li>
</ul>
</li>
<li>开放封闭原则
<ul>
<li>软件实体（类、模块、函数等）可以扩展，但是不可以修改，即对于扩展是开放的，对于修改是封闭的，其实就是实现多态，创建新的子类并重写父类虚函数，用以更新处理动作</li>
</ul>
</li>
<li>依赖倒转原则
<ul>
<li>高层模块不应该依赖低层模块，两个都应该依赖抽象</li>
<li>抽象不应该依赖细节，细节应该依赖抽象</li>
</ul>
</li>
</ul>
<p>关于依赖倒转原则</p>
<p>高层模块：可以理解为上层应用，就是业务层的实现<br>
低层模块：可以理解为底层接口，比如封装好的 API、动态库等<br>
抽象：指的就是抽象类或者接口，在 C++ 中没有接口，只有抽象类<br>
如果高层模块依赖低层模块，当依赖的低层模块改变，高层代码也要进行对应的修改，无法实现对高层代码的直接复用</p>
<p>里氏代换原则：子类类型必须能够替换掉它们的父类类型<br>
需满足：1. 继承 2. 子类继承的所有父类的属性和方法对于子类来说都是合理的<br>
条件满足后，在实际应用中就可以使用子类替换掉父类，同时功能也不会受到影响，父类实现了复用，子类也能在父类的基础上增加新的行为，这个就是里氏代换原则</p>
<p>抽象不应该依赖细节，细节应该依赖抽象。也就意味着我们应该对细节进行封装，在 C++ 中就是将其放到一个抽象类中（C++ 中没有接口，不能像 Java 一样封装成接口）</p>
<ul>
<li>
<p>抽象类中提供的接口是固定不变的</p>
</li>
<li>
<p>低层模块是抽象类的子类，继承了抽象类的接口，并且可以重写这些接口的行为</p>
</li>
<li>
<p>高层模块想要实现某些功能，调用的是抽象类中的函数接口，并且是通过抽象类的父类指针引用其子类的实例对象（用子类类型替换父类类型），这样就实现了多态</p>
</li>
</ul>
<div align=center><img width = '600' height = '250' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8E%A5%E5%8F%A3or%E6%8A%BD%E8%B1%A1%E7%B1%BB%E7%9A%84%E4%BD%9C%E7%94%A8.PNG"/></div>
<h2 id="设计模式一览"><a class="header-anchor" href="#设计模式一览">¶</a>设计模式一览</h2>
<div align=center><img width = '862' height = '495' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80%E8%A7%88.PNG"/></div>
<h2 id="创建型模式"><a class="header-anchor" href="#创建型模式">¶</a>创建型模式</h2>
<h3 id="工厂方法模式-Factory-Method"><a class="header-anchor" href="#工厂方法模式-Factory-Method">¶</a>工厂方法模式 Factory Method</h3>
<p>工厂方法模式是一种创建型设计模式，其在父类中提供一个创建对象的方法，允许子类决定实例化对象的类型</p>
<p>它的别称 <strong>虚拟构造函数</strong>（Virtual Constructor）很好的描述了它的实质，即使用特殊的工厂方法代替对于对象构造函数的直接调用，工厂方法返回的对象即为“产品”</p>
<p>简单工厂模式与工厂模式的不同在于其只使用一个工厂类来生产许多不同的产品对象，这种方式违反了设计模式中的开放—封闭原则，在工厂模式中，用一个基类包含一个虚工厂函数用于实现多态，再用多个子类重写父类的工厂函数</p>
<div align=center><img width = '931' height = '555' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F.PNG"/></div>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">doStuff</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~Product() &#123;&#125;   </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProductA</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doStuff</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProductB</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doStuff</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// do something else</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Creator</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Product* <span class="title">createProduct</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    Virtual ~Creator() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteCreatorA</span> :</span> <span class="keyword">public</span> Creator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Product* <span class="title">createProduct</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductA();</span><br><span class="line">    &#125;</span><br><span class="line">    ~ConcreteCreatorA() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteCreatorB</span> :</span> <span class="keyword">public</span> Creator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Product* <span class="title">createProduct</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductB();</span><br><span class="line">    &#125;</span><br><span class="line">    ~ConcreteCreatorB() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Creator* factory = <span class="keyword">new</span> ConcreteCreatorA;</span><br><span class="line">    Product* obj = factory-&gt;createProduct();</span><br><span class="line">    obj-&gt;doStuff();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="抽象工厂模式-Abstract-Factory"><a class="header-anchor" href="#抽象工厂模式-Abstract-Factory">¶</a>抽象工厂模式 Abstract Factory</h3>
<p>抽象工厂模式是一种创建型设计模式，它能创建一系列相关的对象，而无需指定其具体类</p>
<p>什么是 <strong>系列对象</strong>？ 例如有这样一组的对象： ​ 运输工具外壳 + 运动引擎 + 控制系统，它可能会有几个变体：</p>
<p>汽车钢板外壳 + 内燃机 + 方向盘离合油门刹车（汽车控制系统）<br>
飞机钛合金外壳 + 喷气式发动机 + 操纵杆（飞机控制系统）</p>
<p>另一个例子：使用现代Modern、维多利亚Victorian、装饰风艺术Art­Deco等风格生成不同的椅子、沙发和咖啡桌</p>
<p>抽象工厂模式给一系列功能相同但是属性会发生变化的组件添加一个抽象类，这样就可以非常方便地进行后续的拓展，再搭配工厂类就可以创建出我们需要的对象了</p>
<p>工厂模式创建的对象对应的类不需要提供抽象类，而抽象工厂模式创建的对象对应的类有抽象的基类，其对应的产品类组件中有可变因素</p>
<p>如果抽象工厂模式创建的一系列相关对象需要组装成一个整体，可以定义整体类，然后直接在具体工厂中组装出来</p>
<div align=center><img width = '877' height = '562' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.PNG"/></div>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ProductA</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractProductA</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">fuction</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~AbstractProductA() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProductA1</span> :</span> <span class="keyword">public</span> AbstractProductA</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fuction</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ProductA1 do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProductA2</span> :</span> <span class="keyword">public</span> AbstractProductA</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fuction</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ProductA2 do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ProductB</span></span><br><span class="line"><span class="comment">// as same as ProductA</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// AbstractFactory</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractFactory</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ProductA* <span class="title">createProductA</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ProductB* <span class="title">createProductB</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~AbstractFactory() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConcreteFactory1</span></span><br><span class="line"><span class="comment">// create ProductA1 and ProductB1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory1</span> :</span> <span class="keyword">public</span> AbstractFactory</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ProductA* <span class="title">createProductA</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductA1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ProductB* <span class="title">createProductB</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductB1();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConcreteFactory2</span></span><br><span class="line"><span class="comment">// create ProductA2 and ProductB2</span></span><br><span class="line"><span class="comment">// as same as ConcreteFactory1</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Client</span>(AbstractFactory f) : factory(f) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">someOption</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    AbstractFactory factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="单例模式-Singleton"><a class="header-anchor" href="#单例模式-Singleton">¶</a>单例模式 Singleton</h3>
<p>单例模式是一种创建型设计模式，让你能够保证一个类只有一个实例，并为该实例提供一个全局访问节点，单例模式同时解决了两个问题，所以违反了单一职责原则</p>
<p>要保证一个类的实例有且仅有一个，就必须采取一些防护措施，涉及一个类多对象操作的函数有以下几个：</p>
<ul>
<li>构造函数：创建一个新的对象</li>
<li>拷贝构造函数：根据已有对象拷贝出一个新的对象</li>
<li>拷贝赋值操作符重载函数：两个对象之间的赋值</li>
</ul>
<p>作以下处理：</p>
<ul>
<li>构造函数私有化，防止其他对象使用单例类的 new 运算符，<br>
构造函数在类内部只调用一次
<ul>
<li>由于使用者在类外部不能使用构造函数，所以在类内部创建的这个唯一的对象必须是 <strong>静态的</strong>，这样就可以通过类名来访问了，为了不破坏类的封装，将这个静态对象的访问权限设置为 <strong>私有的</strong></li>
<li>在类中只有它的静态成员函数才能访问其静态成员变量，所以可以给这个单例类提供一个静态函数用于得到这个静态的单例对象，该函数会 “偷偷” 调用私有构造函数来创建对象， 并将其保存在这个静态成员变量中，此后所有对于该函数的调用都将返回这一缓存对象</li>
</ul>
</li>
<li>拷贝构造函数私有化或者禁用</li>
<li>拷贝赋值操作符重载函数私有化或者禁用</li>
</ul>
<div align=center><img width = '630' height = '385' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F.PNG"/></div>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单例模式的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// = delete 代表函数禁用，也可以将其访问权限设置为私有</span></span><br><span class="line">    Singleton(<span class="keyword">const</span> Singleton&amp; obj) = <span class="keyword">delete</span>;</span><br><span class="line">    Singleton&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Singleton&amp; obj) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Singleton* <span class="title">getInstance</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Singleton() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">static</span> Singleton* m_obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="原型模式-Prototype"><a class="header-anchor" href="#原型模式-Prototype">¶</a>原型模式 Prototype</h3>
<p>原型模式是一种创建型设计模式，使你能够复制已有对象，而又无需使代码依赖它们所属的类</p>
<p>原型模式将克隆过程委派给被克隆的实际对象。模式为所有支持克隆的对象声明了一个通用接口，该接口让你能够克隆对象，同时又无需将代码和对象所属类耦合。通常情况下，这样的接口中仅包含一个克隆方法</p>
<p>注：拷贝构造函数的局限：克隆可能会在父类和子类之间进行，并且可能是动态的，很明显通过父类的拷贝构造函数无法实现对子类对象的拷贝</p>
<div align=center><img width = '795' height = '492' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F.PNG"/></div>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prototype</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Prototype() &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~Prototype() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Prototype* <span class="title">Clone</span><span class="params">()</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcretePrototype</span> :</span> <span class="keyword">public</span> Prototype &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ConcretePrototype() &#123;&#125;</span><br><span class="line">    <span class="function">Prototype* <span class="title">Clone</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcretePrototype(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="结构型模式"><a class="header-anchor" href="#结构型模式">¶</a>结构型模式</h2>
<h3 id="享元模式-Flyweight"><a class="header-anchor" href="#享元模式-Flyweight">¶</a>享元模式 Flyweight</h3>
<p>享元模式是一种结构型设计模式，它摒弃了在每个对象中保存所有数据的方式，通过共享多个对象所共有的相同状态，让你能在有限的内存容量中载入更多对象</p>
<p>对象的常量数据通常被称为 <strong>内在状态</strong>，其位于对象中，其他对象只能读取但不能修改其数值。而对象的其他状态常常能被其他对象“从外部”改变，因此被称为 <strong>外在状态</strong>。例：射击游戏的粒子Particle类中子弹的颜色和精灵图sprite都一样，为其内在状态（其实也是消耗内存最多的成员变量，所以为了节约内存容量，对其进行复用而不是重复存储），但它的另一些状态（坐标、移动矢量和速度）的数值不断变化，为其外在状态</p>
<p>享元模式建议不在对象中存储外在状态，而是将其传递给依赖于它的一个特殊方法，程序只在对象中保存内在状态，以便复用， 这些对象的区别仅在于其内在状态，与外在状态相比，内在状态的变体要少很多，于是对象数量会大大削减，将仅存储内在状态的对象称为 <strong>享元</strong>，须确保其状态不能被修改（享元类的状态只能由构造函数的参数进行一次性初始化，不能对其他对象公开其设置器或公有成员变量），而外在状态会被移动到容器对象中，也就是我们应用享元模式前的聚合对象中，或者创建独立的情景类来存储外在状态和对享元对象的引用</p>
<p>为了能更方便地访问各种享元，你可以创建一个工厂方法来管理已有享元对象的缓存池。工厂方法从客户端处接收目标享元对象的内在状态作为参数，如果它能在缓存池中找到所需享元，则将其返回给客户端；如果没有找到，它就会新建一个享元，并将其添加到缓存池中</p>
<p>可以选择在程序的不同地方放入该函数。最简单的选择就是将其放置在享元容器中。除此之外，还可以新建一个工厂类，或者创建一个静态的工厂方法并将其放入实际的享元类中</p>
<div align=center><img width = '879' height = '622' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F.PNG"/></div>
<h2 id="行为模式"><a class="header-anchor" href="#行为模式">¶</a>行为模式</h2>
<h3 id="命令模式-Command"><a class="header-anchor" href="#命令模式-Command">¶</a>命令模式 Command</h3>
<p>命令模式是一种行为设计模式，它可将请求转换为一个包含与请求相关的所有信息的独立对象。该转换让你能根据不同的请求将方法参数化、延迟请求执行或将其放入队列中，且能实现可撤销操作</p>
<p>例：开发文字编辑器中包含多个按钮的工具栏，GUI层将工作委派给业务逻辑底层，命令模式建议GUI对象不直接提交这些请求，而是将请求的所有细节抽取出来组成命令类，命令类是减少 GUI 和业务逻辑层之间耦合的中间层</p>
<div align=center><img width = '885' height = '592' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F.PNG"/></div>
<h3 id="策略模式-Strategy"><a class="header-anchor" href="#策略模式-Strategy">¶</a>策略模式 Strategy</h3>
<p>策略模式是一种行为设计模式，它能让你定义一系列算法，并将每种算法分别放入独立的类中，以使算法的对象能够相互替换</p>
<p>名为上下文的原始类必须包含一个成员变量来存储对于每种策略的引用，上下文并不执行任务，而是将工作委派给已连接的策略对象</p>
<p>上下文不负责选择符合任务需要的算法——客户端会将所需策略传递给上下文。实际上，上下文并不十分了解策略，它会通过同样的通用接口与所有策略进行交互，而该接口只需暴露一个方法来触发所选策略中封装的算法即可</p>
<p>因此，上下文可独立于具体策略。这样就可在不修改上下文代码或其他策略的情况下添加新算法或修改已有算法了</p>
<p>应用场景：不同交通工具的路线规划</p>
<div align=center><img width = '870' height = '405' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F.PNG"/></div>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Strategy</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~Strategy() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">doAlgorithm</span><span class="params">(<span class="built_in">std</span>::string_view data)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//c++ 17中，标准库新增了一个特殊的字符串类std::string_view</span></span><br><span class="line">    <span class="comment">//它允许我们像std::string一样处理字符序列，而不需要为这些字符序列分配内存</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Strategy&gt; strategy_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Context</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Strategy&gt; &amp;&amp;strategy = &#123;&#125;)</span> : <span class="title">strategy_</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">move</span>(strategy))</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_strategy</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Strategy&gt; &amp;&amp;strategy)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        strategy_ = <span class="built_in">std</span>::<span class="built_in">move</span>(strategy);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doSomeBusinessLogic</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strategy_) &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Context: Sorting data using the strategy (not sure how it'll do it)\n"</span>;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> result = strategy_-&gt;doAlgorithm(<span class="string">"aecbd"</span>);</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; result &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Context: Strategy isn't set\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> :</span> <span class="keyword">public</span> Strategy</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">doAlgorithm</span><span class="params">(<span class="built_in">std</span>::string_view data)</span> <span class="keyword">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">result</span><span class="params">(data)</span></span>;</span><br><span class="line">        <span class="built_in">std</span>::sort(<span class="built_in">std</span>::<span class="built_in">begin</span>(result), <span class="built_in">std</span>::<span class="built_in">end</span>(result));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> :</span> <span class="keyword">public</span> Strategy</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">doAlgorithm</span><span class="params">(<span class="built_in">std</span>::string_view data)</span> <span class="keyword">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">result</span><span class="params">(data)</span></span>;</span><br><span class="line">        <span class="built_in">std</span>::sort(<span class="built_in">std</span>::<span class="built_in">begin</span>(result), <span class="built_in">std</span>::<span class="built_in">end</span>(result), <span class="built_in">std</span>::greater&lt;&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clientCode</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Context <span class="title">context</span><span class="params">(<span class="built_in">std</span>::make_unique&lt;ConcreteStrategyA&gt;())</span></span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Client: Strategy is set to normal sorting.\n"</span>;</span><br><span class="line">    context.doSomeBusinessLogic();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Client: Strategy is set to reverse sorting.\n"</span>;</span><br><span class="line">    context.set_strategy(<span class="built_in">std</span>::make_unique&lt;ConcreteStrategyB&gt;());</span><br><span class="line">    context.doSomeBusinessLogic();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    clientCode();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output.txt:执行结果</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Client: Strategy is set to normal sorting.</span></span><br><span class="line"><span class="comment">Context: Sorting data using the strategy (not sure how it'll do it)</span></span><br><span class="line"><span class="comment">abcde</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Client: Strategy is set to reverse sorting.</span></span><br><span class="line"><span class="comment">Context: Sorting data using the strategy (not sure how it'll do it)</span></span><br><span class="line"><span class="comment">edcba</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="状态模式-State"><a class="header-anchor" href="#状态模式-State">¶</a>状态模式 State</h3>
<p>状态模式是一种行为设计模式，让你能在一个对象的内部状态变化时改变其行为，使其看上去就像改变了自身所属的类一样</p>
<p>状态模式与 <strong>有限状态机</strong> 的概念紧密相关，其主要思想是程序在任意时刻仅可处于几种 <strong>有限</strong> 的 <strong>状态</strong> 中。在任何一个特定状态中，程序的行为都不相同，且可瞬间从一个状态切换到另一个状态。不过，根据当前状态，程序可能会切换到另外一种状态，也可能会保持当前状态不变。这些数量有限且预先定义的状态切换规则被称为 <strong>转移</strong></p>
<p>将该方法应用在对象上，假如有一个文档 Document 类，文档可能会处于草稿 Draft、审阅中 Moderation 和已发布 Published 三种状态中的一种。文档的 publish 发布方法在不同状态下的行为略有不同：</p>
<ul>
<li>处于草稿状态时，它会将文档转移到审阅中状态</li>
<li>处于审阅中状态时，如果当前用户是管理员，它会公开发布文档</li>
<li>处于已发布状态时，它不会进行任何操作</li>
</ul>
<div align=center><img width = '370' height = '440' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%96%87%E6%A1%A3%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%85%A8%E9%83%A8%E7%8A%B6%E6%80%81%E5%92%8C%E8%BD%AC%E7%A7%BB.PNG"/></div>
<p>基于条件语句的状态机，代码的维护工作非常艰难，随着时间推移，最初仅包含有限条件语句的简洁状态机可能会变成臃肿的一团乱麻，而状态模式建议为对象的所有可能状态新建一个类， 然后将所有状态的对应行为抽取到这些类中</p>
<p>原始对象被称为上下文（context），它并不会自行实现所有行为， 而是会保存一个指向表示当前状态的状态对象的引用，且将所有与状态相关的工作委派给该对象。如需将上下文转换为另外一种状态，则需将当前活动的状态对象替换为另外一个代表新状态的对象。采用这种方式是有前提的：所有状态类都必须遵循同样的接口，而且上下文必须仅通过接口与这些对象进行交互</p>
<div align=center><img width = '885' height = '525' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F.PNG"/></div>
<p>状态可被视为策略的扩展，两者都基于组合机制，通过将部分工作委派给 “帮手” 对象来改变其在不同情景下的行为。在状态模式中，特定状态知道其他所有状态的存在，且能触发从一个状态到另一个状态的转换；而策略模式中则几乎完全不知道其他策略的存在，相互之间完全独立</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Context *context_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~State() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_context</span><span class="params">(Context *context)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;context_ = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Handle1</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Handle2</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    State *state_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Context(State *state) : state_(<span class="literal">nullptr</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;TransitionTo(state);</span><br><span class="line">    &#125;</span><br><span class="line">    ~Context() </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> state_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">TransitionTo</span><span class="params">(State *state)</span> <span class="comment">// changeState</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Context: Transition to "</span> &lt;&lt; <span class="keyword">typeid</span>(*state).name() &lt;&lt; <span class="string">".\n"</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;state_ != <span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">delete</span> <span class="keyword">this</span>-&gt;state_;</span><br><span class="line">        <span class="keyword">this</span>-&gt;state_ = state;</span><br><span class="line">        <span class="keyword">this</span>-&gt;state_-&gt;set_context(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Request1</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;state_-&gt;Handle1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Request2</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;state_-&gt;Handle2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span> :</span> <span class="keyword">public</span> State</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Handle1</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Handle2</span><span class="params">()</span> <span class="keyword">override</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ConcreteStateA handles request2.\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span> :</span> <span class="keyword">public</span> State </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Handle1</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ConcreteStateB handles request1.\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Handle2</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ConcreteStateB handles request2.\n"</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ConcreteStateB wants to change the state of the context.\n"</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;context_-&gt;TransitionTo(<span class="keyword">new</span> ConcreteStateA);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ConcreteStateA::Handle1</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ConcreteStateA handles request1.\n"</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ConcreteStateA wants to change the state of the context.\n"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>-&gt;context_-&gt;TransitionTo(<span class="keyword">new</span> ConcreteStateB);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClientCode</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Context *context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStateA);</span><br><span class="line">    context-&gt;Request1();</span><br><span class="line">    context-&gt;Request2();</span><br><span class="line">    <span class="keyword">delete</span> context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ClientCode();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output.txt:执行结果</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Context: Transition to class ConcreteStateA.</span></span><br><span class="line"><span class="comment">ConcreteStateA handles request1.</span></span><br><span class="line"><span class="comment">ConcreteStateA wants to change the state of the context.</span></span><br><span class="line"><span class="comment">Context: Transition to class ConcreteStateB.</span></span><br><span class="line"><span class="comment">ConcreteStateB handles request2.</span></span><br><span class="line"><span class="comment">ConcreteStateB wants to change the state of the context.</span></span><br><span class="line"><span class="comment">Context: Transition to class ConcreteStateA.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="观察者模式-Observer"><a class="header-anchor" href="#观察者模式-Observer">¶</a>观察者模式 Observer</h3>
<p>观察者模式是一种行为设计模式，允许你定义一种订阅机制，可在对象事件发生时通知多个“观察”该对象的其他对象</p>
<p>拥有一些值得关注的状态的对象通常被称为目标，由于它要将自身的状态改变通知给其他对象，也将其称为发布者（publisher），所有希望关注发布者状态变化的其他对象被称为订阅者（subscribers）</p>
<p>观察者模式建议为发布者类添加订阅机制，让每个对象都能订阅或取消订阅发布者事件流，该机制包括 1）一个用于存储订阅者对象引用的列表成员变量；2）几个用于添加或删除该列表中订阅者的公有方法；无论何时发生了重要的发布者事件，都要遍历订阅者并调用其对象的特定通知方法</p>
<p>所有订阅者都必须实现同样的接口，发布者仅通过该接口与订阅者交互，接口中必须声明通知方法及其参数；甚至可以进一步让所有发布者遵循同样的接口，这样订阅者就能在不与具体发布者类耦合的情况下通过接口观察发布者的状态</p>
<div align=center><img width = '885' height = '525' src ="http://cloudplayer99.oss-cn-beijing.aliyuncs.com/blog_pic/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F.PNG"/></div>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者（订阅者）的抽象类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IObserver</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~IObserver() &#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; message_from_subject)</span> </span>= <span class="number">0</span>;   <span class="comment">// 得到消息后更新自己的状态</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布者的抽象类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISubject</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~ISubject() &#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Attach</span><span class="params">(IObserver* observer)</span> </span>= <span class="number">0</span>;                       <span class="comment">// 添加订阅者</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Detach</span><span class="params">(IObserver* observer)</span> </span>= <span class="number">0</span>;                       <span class="comment">// 删除订阅者</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Notify</span><span class="params">()</span> </span>= <span class="number">0</span>;                                          <span class="comment">// 将通知信息发给所有订阅者</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体发布者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> :</span> <span class="keyword">public</span> ISubject &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~Subject();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Attach</span><span class="params">(IObserver* observer)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Detach</span><span class="params">(IObserver* observer)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Notify</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateMessage</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> message)</span></span>;                            <span class="comment">// 传入消息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">HowManyObserver</span><span class="params">()</span></span>;                                             <span class="comment">// 统计现有的订阅者数量</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SomeBusinessLogic</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;IObserver*&gt; list_observer_;                               <span class="comment">// 存储订阅者对象引用的列表成员变量</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> message_;                                               <span class="comment">// 消息字符串</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体订阅者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> :</span> <span class="keyword">public</span> IObserver</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Observer(Subject&amp; subject);</span><br><span class="line">    <span class="keyword">virtual</span> ~Observer();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; message_from_subject)</span> <span class="keyword">override</span></span>;      <span class="comment">// 更新方法，传递发布者消息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RemoveMeFromTheList</span><span class="params">()</span></span>;                                         <span class="comment">// 将该订阅者对象从列表中删除（调用 Detach）</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PrintInfo</span><span class="params">()</span></span>;                                                   <span class="comment">// 显示信息</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> message_from_subject_;                                  <span class="comment">// 发布者消息的缓存</span></span><br><span class="line">    Subject&amp; subject_;                                                  <span class="comment">// 发布者对象的引用</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> static_number_;                                          <span class="comment">// 订阅者数量</span></span><br><span class="line">    <span class="keyword">int</span> number_;                                                        <span class="comment">// 订阅者编号 </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat.png" alt="Cloud_Player 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Cloud_Player 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Cloud_Player
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://cloudplayer99.github.io/2023/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A5%E9%97%A8/" title="C++设计模式速成笔记">https://cloudplayer99.github.io/2023/02/28/设计模式入门/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C-C/" rel="tag"># C/C++</a>
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"># 学习笔记</a>
              <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag"># 设计模式</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/23/%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/" rel="prev" title="算法入门基础">
      <i class="fa fa-chevron-left"></i> 算法入门基础
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/03/11/leetcodeDay1/" rel="next" title="LeetCode Day1">
      LeetCode Day1 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#"><span class="nav-number">1.</span> <span class="nav-text">C++设计模式速成笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#预备知识"><span class="nav-number">1.1.</span> <span class="nav-text">预备知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设计模式三原则"><span class="nav-number">1.2.</span> <span class="nav-text">设计模式三原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设计模式一览"><span class="nav-number">1.3.</span> <span class="nav-text">设计模式一览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建型模式"><span class="nav-number">1.4.</span> <span class="nav-text">创建型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#工厂方法模式-Factory-Method"><span class="nav-number">1.4.1.</span> <span class="nav-text">工厂方法模式 Factory Method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽象工厂模式-Abstract-Factory"><span class="nav-number">1.4.2.</span> <span class="nav-text">抽象工厂模式 Abstract Factory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单例模式-Singleton"><span class="nav-number">1.4.3.</span> <span class="nav-text">单例模式 Singleton</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原型模式-Prototype"><span class="nav-number">1.4.4.</span> <span class="nav-text">原型模式 Prototype</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结构型模式"><span class="nav-number">1.5.</span> <span class="nav-text">结构型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#享元模式-Flyweight"><span class="nav-number">1.5.1.</span> <span class="nav-text">享元模式 Flyweight</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#行为模式"><span class="nav-number">1.6.</span> <span class="nav-text">行为模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命令模式-Command"><span class="nav-number">1.6.1.</span> <span class="nav-text">命令模式 Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#策略模式-Strategy"><span class="nav-number">1.6.2.</span> <span class="nav-text">策略模式 Strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式-State"><span class="nav-number">1.6.3.</span> <span class="nav-text">状态模式 State</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#观察者模式-Observer"><span class="nav-number">1.6.4.</span> <span class="nav-text">观察者模式 Observer</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Cloud_Player"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Cloud_Player</p>
  <div class="site-description" itemprop="description">Coding for fun</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">84</span>
          <span class="site-state-item-name">博文</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/cloudplayer99" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cloudplayer99" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:newphilosophy1504@gmail.com" title="E-Mail → mailto:newphilosophy1504@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/cloudplayer99" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;cloudplayer99" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/348530250" title="bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;348530250" rel="noopener" target="_blank"><i class="fab fa-bilibili fa-fw"></i>bilibili</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/qq_43742385" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_43742385" rel="noopener" target="_blank">烯烃@</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/33ae80156f74" title="https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;33ae80156f74" rel="noopener" target="_blank">Day_cun</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://music.163.com/#/artist?id=30002005" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;artist?id&#x3D;30002005" rel="noopener" target="_blank">DEANBE</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cloud_Player</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">472k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">7:09</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '4c51b139d4c2973e0cbc',
      clientSecret: 'f34e9dd30d03bcdd48050c5aed39458dc83e1772',
      repo        : 'cloudplayer99.github.io',
      owner       : 'cloudplayer99',
      admin       : ['cloudplayer99'],
      id          : '2023/02/28/设计模式入门/',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":300,"height":300,"hOffset":-50,"vOffset":100},"mobile":{"show":true},"log":false});</script></body>
</html>
